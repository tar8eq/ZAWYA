<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title> ZAWIA STORE </title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&amp;display=swap" rel="stylesheet"/>
<style>
    body {
      font-family: 'Tajawal', sans-serif;
      margin: 0;
      background-color: #ffe9f0; /* لون زهري خفيف */
      direction: rtl;
    }
    header {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      padding: 12px;
      background-color: #ffffff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      user-select: none;
      color: #002060;
    }
    #tabs {
      display: flex;
      gap: 10px;
      justify-content: center;
      padding: 10px 0;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      user-select: none;
      flex-wrap: wrap;
    }
    .tab {
      cursor: pointer;
      padding: 8px 18px;
      background-color: #f0f4ff;
      border-radius: 12px;
      font-weight: bold;
      color: #002A6C;
      user-select: none;
      transition: background-color 0.3s;
      white-space: nowrap;
    }
    .tab.active {
  border-bottom: 3px solid #2e4dff;
  color: #2e4dff;
  background-color: #e6ebff;
}

    #shops-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      padding: 16px;
      justify-content: center;
      max-width: 960px;
      margin: 0 auto 60px;
    }
    .shop-card {
      background-color: white;
      border-radius: 15px;
      padding: 14px;
      box-shadow: 0 0 8px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      user-select: none;
      transition: transform 0.2s;
      color: #002060;
    }
    .shop-card:hover {
      transform: scale(1.04);
    }
    .shop-img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .shop-name {
      font-size: 18px;
      font-weight: bold;
      margin: 10px 0 6px;
      text-align: center;
      color: #002A6C;
    }
#shops-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 16px;
  padding: 16px;
}


    #products-page {
      display: none;
      max-width: 960px;
      margin: 0 auto 40px;
      padding: 0 16px;
    }
    #shop-title {
      font-size: 26px;
      font-weight: bold;
      color: #002060;
      text-align: center;
      margin-bottom: 18px;
      user-select: none;
    }
    #subcategories {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      justify-content: center;
      margin-bottom: 24px;
      user-select: none;
    }
    .subcategory {
      background-color: #f0f4ff;
      padding: 10px 22px;
      border-radius: 16px;
      cursor: pointer;
      font-weight: bold;
      color: #002A6C;
      white-space: nowrap;
      transition: background-color 0.3s;
    }
    .subcategory.active {
  background-color: #002A6C; /* لون داكن */
  color: white;
}



    #products-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 18px;
      justify-content: center;
    }
    .product-card {
      background-color: white;
      border-radius: 15px;
      padding: 16px 12px 18px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
      cursor: default;
      transition: transform 0.15s ease-in-out;
      min-height: 350px;
      color: #002060;
    }
    .product-card:hover {
      transform: scale(1.05);
    }
    .product-card img {
  width: 100%;
  height: auto;
  max-height: 140px;
  object-fit: cover;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  margin-bottom: 12px;
}

    .product-name {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 8px;
      color: #002A6C;
      text-align: center;
    }
    .product-price {
      color: #d21f1f;
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 10px;
      user-select: text;
    }
    .sizes {
      display: flex;
      gap: 8px;
      margin-bottom: 14px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .size-btn {
      padding: 6px 12px;
      background-color: #cdd2ff;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      font-size: 14px;
      line-height: 1.2;
      min-width: 32px;
      text-align: center;
      transition: background-color 0.3s;
      user-select:none;
    }
    .size-btn.selected {
      background-color: #2e4dff;
      color: white;
    }
    .add-to-cart-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px 16px;
      background-color: #2e4dff;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
      width: 54px;
      height: 44px;
      margin-top: auto;
    }
    .add-to-cart-btn:hover {
      background-color: #1a32cc;
    }
    .add-to-cart-btn i {
      font-size: 22px;
      pointer-events: none;
    }
#cart-btn {
  font-size: 28px; /* الحجم الافتراضي للكبير */
  /* إعدادات أخرى */
}

@media (max-width: 480px) {
  #cart-btn {
    font-size: 40px; /* حجم أصغر للتلفون */
    top: 14px;        /* تحكم بموقع السلة من الأعلى */
    left: 14px;       /* تحكم بموقع السلة من اليسار */
    padding: 5px 8px; /* تعديل الحشوة */
  }
}

    #cart-btn {
  position: relative;
  margin-right: 12px; /* بدل left */
  background-color: #2600fb;
  border-radius: 50%;
  padding: 8px;
  font-size: 22px;
  box-shadow: 0 1px 4px rgba(255, 254, 254, 0.1);
  cursor: pointer;
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
}

#cart-count {
  position: absolute;
  top: -8px;
  right: -10px;
  background-color: red;
  color: white;
  font-size: 12px;
  font-weight: bold;
  border-radius: 50%;
  width: 18px;
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
}

   #cart-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(71, 21, 237, 0.5);
      display: none;
      justify-content: flex-start;
      align-items: flex-start;
      padding: 20px;
      z-index: 2000;
      overflow-y: auto;
      box-sizing: border-box;
    }
    #cart-content {
      background: white;
      width: 400px;
      max-width: 100%;
      max-height: 90vh;
      border-radius: 15px;
      box-shadow: 0 0 12px rgba(0,0,0,0.25);
      display: flex;
      flex-direction: column;
      padding: 18px;
      user-select: none;
      position: relative;
      margin-top: 16px;
    }
    #cart-content h2 {
      margin: 0 0 14px 0;
      text-align: center;
      color: #002060;
    }
    #cart-items {
      flex-grow: 1;
      overflow-y: auto;
      margin-bottom: 14px;
      max-height: 400px;
    }
    .cart-shop-group {
      margin-bottom: 18px;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    .cart-shop-group h3 {
      margin: 0 0 8px 0;
      color: #2e4dff;
      font-weight: 700;
      font-size: 18px;
      border-bottom: 2px solid #2e4dff;
      padding-bottom: 4px;
    }
    .cart-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
      font-size: 15px;
      color: #002060;
    }
    .cart-item-details {
      flex-grow: 1;
    }
    .cart-item-quantity {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 0 10px;
    }
    .cart-item-quantity button {
      padding: 3px 8px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      user-select: none;
      border: 1px solid #002A6C;
      border-radius: 8px;
      background: white;
      color: #002A6C;
      transition: background-color 0.2s;
    }
    .cart-item-quantity button:hover {
      background-color: #002A6C;
      color: white;
    }
    .cart-item-remove {
      background: none;
      border: none;
      color: #d21f1f;
      font-weight: bold;
      font-size: 20px;
      cursor: pointer;
      user-select: none;
      padding: 0 6px;
      transition: color 0.3s;
    }
    .cart-item-remove:hover {
      color: #a11616;
    }
    #cart-total {
      font-weight: bold;
      font-size: 18px;
      color: #002060;
      text-align: center;
      margin-bottom: 14px;
      user-select: text;
    }
    #confirm-order-btn {
      background-color: #2e4dff;
      color: white;
      font-weight: bold;
      padding: 12px;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
      width: 100%;
      margin-bottom: 10px;
      font-size: 17px;
    }
    #confirm-order-btn:hover {
      background-color: #1a32cc;
    }
    #order-form {
      display: none;
      flex-direction: column;
      gap: 14px;
    }
    #order-form input, #order-form textarea {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #ccc;
      border-radius: 12px;
      font-size: 16px;
      font-family: 'Tajawal', sans-serif;
      resize: vertical;
      user-select: text;
    }
    #order-form textarea {
      min-height: 70px;
    }
    #order-form button {
      padding: 12px;
      background-color: #2e4dff;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
      font-size: 17px;
    }
    #order-form button:hover {
      background-color: #1a32cc;
    }

    @media (max-width: 480px) {
      header {
        font-size: 18px;
      }
      #shops-container {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      }
      #products-container {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
      .shop-card {
        padding: 12px;
      }
      .shop-img {
        height: 140px;
      }
      .product-card {
        min-height: 300px;
      }
      .product-card img {
        height: 120px;
      }
      .product-name {
        font-size: 15px;
      }
      .product-price {
        font-size: 16px;
      }
      .size-btn {
        padding: 5px 10px;
        font-size: 13px;
        min-width: 28px;
      }
      .add-to-cart-btn {
        width: 44px;
        height: 36px;
        font-size: 18px;
      }
      .section-title {
    font-size: 18px;
  }
  .subcategory {
    font-size: 14px;
    padding: 6px 12px;
  }
      #cart-content {
        width: 95vw;
        padding: 14px;
        max-height: 85vh;
      }
      #cart-overlay {
        padding: 10px;
        justify-content: flex-start;
        align-items: flex-start;
      }
      #cart-btn {
  font-size: 10px; /* حجم رمز السلة */
  position: relative;
  cursor: pointer;
  user-select: none;
  display: inline-block;
  padding: 4px 8px;
}

#cart-count {
  position: absolute;
  top: -6px;
  right: -6px;
  background-color: red;
  color: white;
  font-size: 12px; /* حجم رقم عدد المنتجات */
  font-weight: bold;
  border-radius: 35%;
  padding: 2px 5px;
  min-width: 10px;
  text-align: center;
  box-sizing: border-box;
}
      
    }
    
  </style>

<style>
  .customer-input {
    width: 100%;
    padding: 10px;
    margin-bottom: 12px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-sizing: border-box;
  }
  #cart-overlay {
    max-height: 80vh;
    overflow-y: auto;
  }
</style>

</head>
<body>
<header style="text-align: center; padding-top: 20px;">
<div class="site-title" style="font-size: 26px; font-weight: bold; color: #002A6C;">ZAWIA STORE</div>
<div onclick="showCart()" style="
    margin-top: 14px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    position: relative;
    background-color: #846cf9;
    color: white;
    border-radius: 30px;
    padding: 8px 16px;
    font-size: 18px;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    cursor: pointer;
    user-select: none;
  " title="السلة">
    🛒 <span>السلة</span>
<!-- عدد السلة يظهر فوق -->
<div id="cart-count" style="
      position: absolute;
      top: -8px;
      right: -8px;
      background-color: red;
      color: white;
      font-size: 12px;
      font-weight: bold;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    ">0</div>
</div>
</header>





<div id="tabs"></div> <!-- هنا الأقسام (التابات) -->
<div id="shops"></div> <!-- هنا عرض المحلات -->
<div id="products"></div> <!-- هنا عرض المنتجات -->
<div id="tabs"></div>
<div id="shops-container"></div>
<div id="products-page"><button id="back-to-tabs" style="display: none; margin: 20px auto; padding: 10px 20px; background: #002A6C; color: #fff; border: none; border-radius: 12px; cursor: pointer; font-size: 16px;">الرجوع للأقسام</button>
<!-- حذف الزر بالكامل -->
<div id="shop-title"></div>
<div id="subcategories"></div>
<div id="products-container"></div>
</div>

<button id="back-to-tabs" style="display: none; margin: 20px auto; padding: 6px 18px; background: #002A6C; color: #fff; border: none; border-radius: 12px; cursor: pointer;">
  الرجوع للأقسام
</button>
<div id="cart-overlay" onclick="closeCart(event)">
<div id="cart-content">
<h2>سلة المشتريات</h2>
<div id="cart-items"></div>
<div id="cart-total"></div>
<button id="confirm-order-btn" onclick="showOrderForm()">تأكيد الطلب</button>
<form id="order-form">
<input id="name" class="customer-input" placeholder="الاسم الكامل" required="" type="text"/>
<input id="phone" class="customer-input" placeholder="رقم الهاتف" required="" type="tel"/>
<input id="city" class="customer-input" placeholder="المدينة" required="" type="text"/>
<input id="address" class="customer-input" placeholder="العنوان" required="" type="text"/>
<textarea id="notes" class="customer-input" placeholder="ملاحظات (اختياري)"></textarea>
<button type="submit">إرسال الطلب</button>
<button onclick="hideOrderForm()" style="background:#888;margin-top:8px;" type="button">إلغاء</button>
</form>
</div>
</div>
<script>
    // البيانات
    const sectionsData = {
      "الولااني": [
        {key:"طارق", name:"محل طارق", img:"https://glamorous-design.org/wp-content/uploads/2024/10/piclumen-1727956325686.png"},
        
      ],
      "طريق الصقري": [
        {key:"آية", name:"محل آية", img:"https://i.pinimg.com/originals/99/af/78/99af78d48b3b6b3eb2f72b88e5a023d9.jpg"}
      ],
      "القناعة": [
        {key:"عبادي", name:"محل عبادي", img:"https://i.pinimg.com/736x/53/c2/71/53c271221b812b38c9f409e2f60d0ec0.jpg"}
      ],
      "الزهيوي": [{key:"علي", name:"محل علي", img:"https://globalprintkw.com/wp-content/uploads/2024/12/%D9%88%D8%A7%D8%AC%D9%87%D8%A7%D8%AA-%D9%85%D8%AD%D9%84%D8%A7%D8%AA-%D8%AA%D8%AC%D8%A7%D8%B1%D9%8A%D8%A9-3d.jpg"}
        
      ]
    };

    // كل المحلات بأقسام محددة
    const shops = {
      "طارق": {
        "رجالي": [
          {name: "قميص رجالي", price: 150, img: "https://akn-randb.a-cdn.akinoncloud.com/products/2025/04/07/705216/89bdd015-0303-4d01-bb35-5379c33c2ec0_size3840x4740_cropCenter.jpg"}
        ],
        "نسائي": [
          {name: "فستان سهرة", price: 280, img: "https://ksa.aryamoda.com/cdn/shop/collections/85A00DF5-26DF-4D01-A877-2D1DB1E718A2_b57b5c5a-a535-4b44-bcfd-22e9a6a60372.jpg?v=1743668985"}
        ],
        "أطفال": [
          {name: "تيشيرت أطفال", price: 120, img: "https://matjrah.online/images/4495/image/cache/catalog/1728929951505-024%20Mockup%20man%20copy%202-550x550w.jpg"}
        ],
        "اكسسوار": [
          {name: "نظارات شمسية", price: 100, img: "https://media.zid.store/e522bdf0-d33c-4702-888b-b644c14371be/f470940f-5ea7-4197-a451-6b91a59dc66e.webp"}
        ]
      },
      "علي": {
        "رجالي": [
          {name: "تيشيرت رجالي", price: 120, img: "https://media.zid.store/thumbs/545fceff-736b-4241-bc4d-3dfa7bd1e02b/84c6bc2b-a78e-48cf-a45a-65d1eeb95a50-thumbnail-1000x1000-70.jpg"}
        ],
        "نسائي": [
          {name: "تنورة", price: 180, img: "https://m.media-amazon.com/images/I/71YjJz7SfsL._UF1000,1000_QL80_.jpg"}
        ],
        "أطفال": [
          {name: "حذاء أطفال", price: 110, img: "https://cdn.salla.sa/BExZy/5f4d49fb-ccd7-450c-abf9-29646a40153e-1000x1000-TZJo9sZVlTzcvNW8iGtusQgZQMzcBga0ICdk7G0R.jpg"}
        ],
        "اكسسوار": [
          {name: "ساعة يد", price: 140, img: "https://img.youm7.com/ArticleImgs/2019/12/23/86382-%D8%A7%D8%AE%D8%AA%D9%8A%D8%A7%D8%B1-%D8%B3%D8%A7%D8%B9%D8%A9-%D9%8A%D8%AF.jpg"}
        ]
      },
      "آية": {
        "رجالي": [
          {name: "جاكيت", price: 220, img: "https://daraghmeh.com/storage/media/thumbs/UM2n31vceCIPZSnWA1ftTILMDeS6n2fgRtD1rozZ.jpg"}
        ],
        "نسائي": [
          {name: "بلوزة", price: 190, img: "https://cdn.salla.sa/ZYnGW/78c9d592-e821-4f63-a1c4-6fe600946df3-456.20437956204x500-3jyc3l4WX3kUr70QiVs2LHX7jgg7zly8umyK326T.jpg"}
        ],
        "أطفال": [
          {name: "سروال أطفال", price: 130, img: "https://img.bestdealplus.com/ae04/kf/H153654dfe3324a76af70af18481d171cm.jpg"}
        ],
        "اكسسوار": [
          {name: "قلادة", price: 90, img: "https://seleciajewelry.com/image/catalog/%D8%B3%D9%84%D8%B3%D8%A7%D9%84-%D8%B0%D9%87%D8%A8-%D9%81%D8%B1%D8%A7%D8%B4%D8%A9.jpg"}
        ]
      },
      "عبادي": {
        "رجالي": [
          {name: "بنطال", price: 140, img: "https://cdn.dsmcdn.com/mnresize/600/-/ty1576/product/media/images/prod/PIM/20241003/07/d056da56-59f2-4566-934c-939079699454/1_org_zoom.jpg"}
        ],
        "نسائي": [
          {name: "جاكيت نسائي", price: 200, img: "https://cdn.salla.sa/WlgonV/73febb5e-d1a5-4713-8891-ab04b645afb4-1000x1000-X9xiEzBuAVPoptQLOA9rlACqcu9OG3SpcFjccaRn.jpg"}
        ],
        "أطفال": [
          {name: "قبعة أطفال", price: 95, img: "https://cdn.salla.sa/zoRVK/DHoQK0LQrIfFZU822ikwYoCu4YWRu506yt6th2lP.png"}
        ],
        "اكسسوار": [
          {name: "حزام", price: 85, img: "https://cdn-images.farfetch-contents.com/12/57/12/34/12571234_53138585_1000.jpg"}
        ]
      }
    };

    // تبويب الأقسام الرئيسية (مثلا: الولااني، طريق الصقري، القناعة، الزهيوي، الجميع)
    const mainSections = Object.keys(sectionsData);
    mainSections.unshift("الجميع"); // نضيف قسم الجميع في البداية

    // حالة التطبيق
    let currentMainSection = "الجميع";
    let currentShop = null;
    let currentSubcategory = null;

    // عربة التسوق حسب محل + صنف + مقاس (مفتاح: shopKey|productName|size)
    let cart = {};

    // رقم الطلب يبدأ من localStorage أو 1
    let orderNumber = Number(localStorage.getItem('orderNumber')) || 1;

    // العرض الرئيسي - تبويب الأقسام
   function renderTabs() {
  const tabsDiv = document.getElementById("tabs");
  tabsDiv.innerHTML = "";

  mainSections.forEach(sec => {
    const tab = document.createElement("div");
    tab.classList.add("tab");
    if (sec === currentMainSection) tab.classList.add("active");
    tab.textContent = sec;

    tab.onclick = () => {
      currentMainSection = sec;
      currentShop = null;
      renderTabs();
      renderShops();

// فتح الصورة المكبرة
function openImageModal(src) {
  const modal = document.getElementById("image-modal");
  const modalImg = document.getElementById("modal-img");

  if (modal && modalImg) {
    modalImg.src = src;
    modal.style.display = "flex";
  }
}

// غلق الصورة عند الضغط على أي مكان في الخلفية
document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("image-modal");
  if (modal) {
    modal.addEventListener("click", () => {
      modal.style.display = "none";
    });
  }
});


      // ✅ إخفاء باقي التبويبات غير اللي نقرنا عليه
      // إخفاء باقي التبويبات (الأقسام) لما ندخل محل
const allTabs = document.querySelectorAll("#tabs .tab");
allTabs.forEach(tabEl => {
  if (tabEl.textContent !== currentMainSection) {
    tabEl.style.display = "none";
  }
});

// إظهار زر الرجوع للأقسام
document.getElementById("back-to-tabs").style.display = "block";

    };

    tabsDiv.appendChild(tab);
  });
}
document.getElementById("back-to-tabs").onclick = () => {
  // ترجع تظهر جميع التبويبات
  const allTabs = document.querySelectorAll("#tabs .tab");
  allTabs.forEach(tabEl => {
    tabEl.style.display = "inline-block";
  });

  // تخفي المحلات
  document.getElementById("shops-container").style.display = "none";

  // تخفي الزر
  document.getElementById("back-to-tabs").style.display = "none";
};



    // عرض المحلات حسب القسم
    function renderShops() {
      const container = document.getElementById("shops-container");
      container.innerHTML = "";
      let shopsToShow = [];

      if (currentMainSection === "الجميع") {
        // جميع المحلات من كل الأقسام
        for (const sec of Object.keys(sectionsData)) {
          shopsToShow = shopsToShow.concat(sectionsData[sec]);
        }
      } else {
        shopsToShow = sectionsData[currentMainSection] || [];
      }

      if (shopsToShow.length === 0) {
        container.innerHTML = `<p style="text-align:center; color:#444;">لا توجد محلات في هذا القسم.</p>`;
        return;
      }

      shopsToShow.forEach(shop => {
        const card = document.createElement("div");
        card.className = "shop-card";
        card.onclick = () => {
          openShop(shop.key, shop.name);
        };

        const img = document.createElement("img");
        img.src = shop.img;
        img.className = "shop-img";
        img.alt = shop.name;

        const name = document.createElement("div");
        name.className = "shop-name";
        name.textContent = shop.name;

        card.appendChild(img);
        card.appendChild(name);
        container.appendChild(card);
      });
    }

    // افتح صفحة المنتجات لمحل معين
   function openShop(shopKey, shopName) {
  currentShop = shopKey;
  currentSubcategory = null;

  // نخفي المحلات
  document.getElementById("shops-container").style.display = "none";

  // نظهر صفحة المنتجات
  document.getElementById("products-page").style.display = "block";
  document.getElementById("shop-title").textContent = shopName;

  // نرسم التصنيفات الفرعية والمنتجات
  renderSubcategories();
  renderProducts();

  // ✅ نخفي باقي التبويبات (الأقسام)
  const allTabs = document.querySelectorAll("#tabs .tab");
  allTabs.forEach(tabEl => {
    if (tabEl.textContent !== currentMainSection) {
      tabEl.style.display = "none";
    }
  });

  // ✅ نظهر زر "الرجوع للأقسام"
  document.getElementById("back-to-tabs").style.display = "block";
}
document.getElementById("back-to-tabs").onclick = () => {
  // 1. نظهر كل التبويبات (الأقسام)
  const allTabs = document.querySelectorAll("#tabs .tab");
  allTabs.forEach(tabEl => {
    tabEl.style.display = "inline-block";
  });

  // 2. نظهر المحلات الخاصة بالقسم الحالي
  document.getElementById("shops-container").style.display = "grid";
  renderShops();

  // 3. نخفي صفحة المنتجات
  document.getElementById("products-page").style.display = "none";

  // 4. نخفي الزر
  document.getElementById("back-to-tabs").style.display = "none";
};


function backToMain() {
  currentShop = null;
  currentSubcategory = null;
  document.getElementById("products-page").style.display = "none";
  document.getElementById("shops-container").style.display = "grid";

  // إبقاء التابات ظاهرة
  document.getElementById("tabs").style.display = "flex";

  // إخفاء زر العودة للرئيسية
  document.getElementById("home-btn").style.display = "none";
}


    // عرض أقسام المنتجات (رجالي، نسائي، أطفال، اكسسوار)
    function renderSubcategories() {
      const subcatDiv = document.getElementById("subcategories");
      subcatDiv.innerHTML = "";
      if (!currentShop) return;

      const categories = Object.keys(shops[currentShop] || {});
      categories.forEach(cat => {
        const div = document.createElement("div");
        div.className = "subcategory";
        if (cat === currentSubcategory || (!currentSubcategory && categories.indexOf(cat) === 0)) {
          div.classList.add("active");
          currentSubcategory = cat;
        }
        div.textContent = cat;
        div.onclick = () => {
          currentSubcategory = cat;
          renderSubcategories();
          renderProducts();
        };
        subcatDiv.appendChild(div);
      });
    }

    // عرض المنتجات في القسم المحدد
    // عرض المنتجات في القسم المحدد
function renderProducts() {
  const container = document.getElementById("products-container");
  container.innerHTML = "";

  if (!currentShop || !currentSubcategory) return;

  const products = shops[currentShop][currentSubcategory] || [];

  if (products.length === 0) {
    container.innerHTML = `<p style="text-align:center; color:#444;">لا توجد منتجات في هذا القسم.</p>`;
    return;
  }

  products.forEach(product => {
    const card = document.createElement("div");
    card.className = "product-card";

    const img = document.createElement("img");
    img.src = product.img;
    img.alt = product.name;
    img.style.cursor = "pointer";
    img.onclick = () => openImageModal(product.img);  // تكبير الصورة

    const name = document.createElement("div");
    name.className = "product-name";
    name.textContent = product.name;

    const price = document.createElement("div");
    price.className = "product-price";
    price.textContent = product.price + " د.ل";

    // إنشاء خيارات المقاسات
    const sizesDiv = document.createElement("div");
    sizesDiv.className = "sizes";
    ["S", "M", "L", "XL"].forEach(size => {
      const sizeBtn = document.createElement("div");
      sizeBtn.className = "size-btn";
      sizeBtn.textContent = size;
      sizeBtn.onclick = () => {
        const prevSelected = sizesDiv.querySelector(".selected");
        if (prevSelected) prevSelected.classList.remove("selected");
        sizeBtn.classList.add("selected");
      };
      sizesDiv.appendChild(sizeBtn);
    });

    // زر الإضافة إلى السلة
    const addBtn = document.createElement("button");
    addBtn.className = "add-to-cart-btn";
    addBtn.title = "أضف إلى السلة";
    addBtn.innerHTML = "🛒";
    addBtn.onclick = () => {
      const selectedSize = sizesDiv.querySelector(".size-btn.selected");
      if (!selectedSize) {
        alert("يرجى اختيار المقاس");
        return;
      }
      addToCart(currentShop, product, selectedSize.textContent);
    };

    // تجميع العناصر في البطاقة
    card.appendChild(img);
    card.appendChild(name);
    card.appendChild(price);
    card.appendChild(sizesDiv);
    card.appendChild(addBtn);

    container.appendChild(card);
  });
}

    

    // إضافة منتج للسلة - كل محل له سلة مستقلة (مفتاح: shop|product|size)
    function addToCart(shopKey, product, size) {
      const key = `${shopKey}|${product.name}|${size}`;
      if (cart[key]) {
        cart[key].quantity++;
      } else {
        cart[key] = {
          shopKey,
          shopName: sectionsDataFindShopName(shopKey),
          productName: product.name,
          price: product.price,
          size,
          quantity: 1
        };
      }
      updateCartCount();
      alert("تم إضافة المنتج إلى السلة");
    }

    // مساعدة: إيجاد اسم المحل من key
    function sectionsDataFindShopName(shopKey) {
      for (const sec of Object.keys(sectionsData)) {
        for (const shop of sectionsData[sec]) {
          if (shop.key === shopKey) return shop.name;
        }
      }
      return shopKey; // إذا لم يجد الاسم
    }

    // تحديث عداد السلة
    function updateCartCount() {
      const count = Object.values(cart).reduce((a,b) => a + b.quantity, 0);
      document.getElementById("cart-count").textContent = count;
    }

    // عرض السلة
    function showCart() {
      if (Object.keys(cart).length === 0) {
        alert("السلة فارغة");
        return;
      }
      renderCartItems();
      document.getElementById("cart-overlay").style.display = "flex";
      hideOrderForm();
    }

    // إخفاء السلة إذا ضغط خارج المحتوى
    function closeCart(e) {
      if (e.target === document.getElementById("cart-overlay")) {
        document.getElementById("cart-overlay").style.display = "none";
        hideOrderForm();
      }
    }

    // عرض عناصر السلة مع تقسيم حسب المحلات
    function renderCartItems() {
      const container = document.getElementById("cart-items");
      container.innerHTML = "";

      // تجميع حسب المحل
      const shopsInCart = {};
      for (const key in cart) {
        const item = cart[key];
        if (!shopsInCart[item.shopKey]) shopsInCart[item.shopKey] = {shopName: item.shopName, items: []};
        shopsInCart[item.shopKey].items.push({...item, key});
      }

      let totalAll = 0;

      for (const shopKey in shopsInCart) {
        const groupDiv = document.createElement("div");
        groupDiv.className = "cart-shop-group";

        const title = document.createElement("h3");
        title.textContent = shopsInCart[shopKey].shopName;
        groupDiv.appendChild(title);

        let totalShop = 0;

        shopsInCart[shopKey].items.forEach(item => {
          const itemDiv = document.createElement("div");
          itemDiv.className = "cart-item";

          const details = document.createElement("div");
          details.className = "cart-item-details";
          details.textContent = `${item.productName} - المقاس: ${item.size}`;

          const qtyDiv = document.createElement("div");
          qtyDiv.className = "cart-item-quantity";

          const minusBtn = document.createElement("button");
          minusBtn.textContent = "-";
          minusBtn.onclick = () => {
            if (item.quantity > 1) {
              cart[item.key].quantity--;
            } else {
              delete cart[item.key];
            }
            updateCartCount();
            renderCartItems();
          };

          const qtyText = document.createElement("span");
          qtyText.textContent = item.quantity;

          const plusBtn = document.createElement("button");
          plusBtn.textContent = "+";
          plusBtn.onclick = () => {
            cart[item.key].quantity++;
            updateCartCount();
            renderCartItems();
          };

          const removeBtn = document.createElement("button");
          removeBtn.className = "cart-item-remove";
          removeBtn.title = "حذف المنتج";
          removeBtn.textContent = "×";
          removeBtn.onclick = () => {
            delete cart[item.key];
            updateCartCount();
            renderCartItems();
          };

          qtyDiv.appendChild(minusBtn);
          qtyDiv.appendChild(qtyText);
          qtyDiv.appendChild(plusBtn);

          itemDiv.appendChild(details);
          itemDiv.appendChild(qtyDiv);
          itemDiv.appendChild(removeBtn);

          groupDiv.appendChild(itemDiv);

          totalShop += item.price * item.quantity;
        });

        const totalShopDiv = document.createElement("div");
        totalShopDiv.style.textAlign = "right";
        totalShopDiv.style.fontWeight = "bold";
        totalShopDiv.style.marginTop = "8px";
        totalShopDiv.style.color = "#002060";
        totalShopDiv.textContent = `المجموع: ${totalShop.toFixed(2)} د.ل`;
        groupDiv.appendChild(totalShopDiv);

        container.appendChild(groupDiv);

        totalAll += totalShop;
      }

      const totalAllDiv = document.getElementById("cart-total");
      totalAllDiv.textContent = `الإجمالي الكلي: ${totalAll.toFixed(2)} د.ل`;
    }

    // اظهار نموذج الطلب
    function showOrderForm() {
      if (Object.keys(cart).length === 0) {
        alert("السلة فارغة");
        return;
      }
      document.getElementById("order-form").style.display = "flex";
      document.getElementById("confirm-order-btn").style.display = "none";
    }

    // إخفاء نموذج الطلب
    function hideOrderForm() {
      document.getElementById("order-form").style.display = "none";
      document.getElementById("confirm-order-btn").style.display = "block";
      document.getElementById("order-form").reset();
    }

    // ارسال الطلب لتليجرام
    async function sendTelegramMessages(orderData) {
      // إعدادات بوت تيليجرام لكل محل
      const shopsTokens = {
        "طارق": "YOUR_TELEGRAM_BOT_TOKEN_1",
        "علي": "YOUR_TELEGRAM_BOT_TOKEN_2",
        "آية": "YOUR_TELEGRAM_BOT_TOKEN_3",
        "عبادي": "YOUR_TELEGRAM_BOT_TOKEN_4"
      };

      // عنوان المحادثة أو رقم الشات لكل محل
      const chatIds = {
        "طارق": "YOUR_CHAT_ID_1",
        "علي": "YOUR_CHAT_ID_2",
        "آية": "YOUR_CHAT_ID_3",
        "عبادي": "YOUR_CHAT_ID_4"
      };

      // إرسال لكل محل طلبه
      for (const shopKey in orderData) {
        if (!orderData.hasOwnProperty(shopKey)) continue;

        const token = shopsTokens[shopKey];
        const chatId = chatIds[shopKey];
        if (!token || !chatId) {
          console.warn(`لم يتم تعيين التوكن أو الشات لمحل: ${shopKey}`);
          continue;
        }

        const shopOrder = orderData[shopKey];
        const itemsText = shopOrder.items.map(item =>
          `- ${item.productName} - المقاس: ${item.size} - الكمية: ${item.quantity} - السعر الفردي: ${item.price} د.ل`
        ).join("\n");

        const totalPrice = shopOrder.items.reduce((a,b) => a + b.price * b.quantity, 0);

        const message = `
🛒 طلبية رقم: ${orderNumber}
🏬 المحل: ${sectionsDataFindShopName(shopKey)}
👤 الاسم: ${shopOrder.customer.name}
📞 الهاتف: ${shopOrder.customer.phone}
🏙️ المدينة: ${shopOrder.customer.city}
🏠 العنوان: ${shopOrder.customer.address}
📝 ملاحظات: ${shopOrder.customer.notes || "لا توجد"}

📦 تفاصيل الطلب:
${itemsText}

💰 إجمالي السعر: ${totalPrice.toFixed(2)} د.ل
        `;

const telegramToken = "7860582198:AAHRrpCCr83B1X1O7BGHebRUc-5h9VaPDBk"; // توكن البوت
const telegramChatId = "355888174"; // رقم حسابك في تيليجرام

async function testSendTelegramMessage() {
  const telegramToken = "7860582198:AAHRrpCCr83B1X1O7BGHebRUc-5h9VaPDBk";
  const telegramChatId = "355888174";
  const message = "رسالة اختبار من المتجر";

  try {
    const response = await fetch(`https://api.telegram.org/bot${telegramToken}/sendMessage`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        chat_id: telegramChatId,
        text: message
      })
    });

    const data = await response.json();
    console.log("Response from Telegram (test):", data);

    if (!data.ok) {
      alert("خطأ في إرسال الرسالة التجريبية: " + data.description);
      return false;
    }
    alert("تم إرسال رسالة اختبار بنجاح");
    return true;
  } catch (error) {
    alert("فشل إرسال الرسالة التجريبية: " + error.message);
    return false;
  }
}



async function confirmOrder(customerData, cartItems) {
  if (!customerData.name || !customerData.phone || !customerData.city || !customerData.address) {
    alert("يرجى تعبئة جميع الحقول المطلوبة");
    return;
  }
  if (cartItems.length === 0) {
    alert("السلة فارغة");
    return;
  }

  let message = `🛒 <b>طلب جديد</b>\n\n`;
  message += `<b>الاسم:</b> ${customerData.name}\n`;
  message += `<b>الهاتف:</b> ${customerData.phone}\n`;
  message += `<b>المدينة:</b> ${customerData.city}\n`;
  message += `<b>العنوان:</b> ${customerData.address}\n`;
  message += `<b>ملاحظات:</b> ${customerData.notes || "لا توجد"}\n\n`;

  message += `<b>تفاصيل الطلب:</b>\n`;
  let total = 0;
  cartItems.forEach((item, idx) => {
    const itemTotal = item.price * item.quantity;
    total += itemTotal;
    message += `${idx + 1}. ${item.productName} - المقاس: ${item.size} - الكمية: ${item.quantity} - السعر: ${item.price} د.ل - المجموع: ${itemTotal} د.ل\n`;
  });
  message += `\n<b>الإجمالي الكلي:</b> ${total} د.ل`;

  const success = await sendTelegramMessage(message);
  if(success) {
    alert("تم إرسال الطلب بنجاح");
    // امسح السلة هنا أو قم بإعادة تحميل الصفحة أو تحديث الواجهة حسب الحاجة
  }
}

// مثال استخدام عند الضغط على زر "تأكيد الطلب":
document.getElementById("order-form").onsubmit = async function(e) {
  e.preventDefault();

  if (Object.keys(cart).length === 0) {
    alert("السلة فارغة");
    return;
  }
  const customerData = {
    name: document.getElementById("name").value.trim(),
    phone: document.getElementById("phone").value.trim(),
    city: document.getElementById("city").value.trim(),
    address: document.getElementById("address").value.trim(),
    notes: document.getElementById("notes").value.trim()
  };
  
  
  // cartItems: مصفوفة من المنتجات في السلة، مثال:
  // [{productName: "تيشيرت", size: "M", quantity: 2, price: 120}, ...]
  const cartItems = getCartItemsSomehow(); // لازم تعرّف كيف تجيب بيانات السلة عندك

  confirmOrder(customerData, cartItems);
}


        // نرسل طلب http
        await fetch(url);
      }
      
    }

    document.getElementById("order-form").onsubmit = async function(e) {
      e.preventDefault();

      if (Object.keys(cart).length === 0) {
        alert("السلة فارغة");
        return;
      }

      // بيانات الزبون
      const customer = {
        name: document.getElementById("name").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        city: document.getElementById("city").value.trim(),
        address: document.getElementById("address").value.trim(),
        notes: document.getElementById("notes").value.trim()
      };

      if (!customer.name || !customer.phone || !customer.city || !customer.address) {
        alert("يرجى تعبئة جميع الحقول المطلوبة");
        return;
      }

      // تقسيم الطلب حسب المحلات
      const orderData = {};
  for (const key in cart) {
    const item = cart[key];
    if (!orderData[item.shopKey]) {
      orderData[item.shopKey] = { customer, items: [] };
    }
    orderData[item.shopKey].items.push(item);
  }
      try {
        await sendTelegramMessages(orderData);
        alert(`تم إرسال الطلب بنجاح. رقم الطلب: ${orderNumber}`);
        cart = {};
        updateCartCount();
        renderCartItems();
        hideOrderForm();
        document.getElementById("cart-overlay").style.display = "none";

        // زيادة رقم الطلب وحفظه
        orderNumber++;
        localStorage.setItem('orderNumber', orderNumber);
      } catch (err) {
        alert("حدث خطأ أثناء إرسال الطلب");
        console.error(err);
      }
      
    };
    

    // البداية
    function showMainPage() {
      document.getElementById("products-page").style.display = "none";
      document.getElementById("shops-container").style.display = "grid";
      document.getElementById("tabs").style.display = "flex";
    }

    renderTabs();
    renderShops();
    
    
  </script>
<style>
.img-popup {
  cursor: pointer;
  transition: 0.3s;
}

.img-popup:hover {
  opacity: 0.7;
}

#imgModal {
  display: none;
  position: fixed;
  z-index: 1000;
  padding-top: 60px;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.8);
}

#imgModalContent {
  margin: auto;
  display: block;
  max-width: 90%;
  max-height: 90%;
}

</style>
<!-- نافذة تكبير الصورة -->
<div id="image-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000;">
<img id="modal-img" src="" style="max-width:90%; max-height:90%; border-radius:12px; box-shadow:0 0 12px rgba(0,0,0,0.5);"/>
</div>
<!-- نافذة تكبير الصورة -->
<div id="image-modal" style="
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.8);
  justify-content: center;
  align-items: center;
  z-index: 9999;
">
<img id="modal-img" style="
    max-width: 90%;
    max-height: 90%;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0,0,0,0.6);
  "/>
</div>
<div id="image-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:9999;"><button id="close-modal-btn" style="position:absolute; top:20px; left:20px; background:#fff; border:none; font-size:28px; border-radius:50%; width:40px; height:40px; cursor:pointer;">×</button><img id="modal-img" style="max-width:90%; max-height:80%; border-radius:12px;"/></div><script>
// تكبير الصورة
function openImageModal(src) {
  const modal = document.getElementById("image-modal");
  const modalImg = document.getElementById("modal-img");
  modalImg.src = src;
  modal.style.display = "flex";
}

// إغلاق الصورة بزر أو عند الضغط خارجها
document.getElementById("image-modal").addEventListener("click", function(e) {
  if (e.target.id === "image-modal" || e.target.id === "close-modal-btn") {
    this.style.display = "none";
  }
});

// تأكيد الطلبية بشكل سليم
document.getElementById("order-form").addEventListener("submit", function(e) {
  e.preventDefault();
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();

  if (!name || !phone) {
    alert("يرجى إدخال الاسم ورقم الهاتف");
    return;
  }

  alert("تم إرسال الطلب بنجاح ✅");
  this.reset();
  document.getElementById("cart-overlay").style.display = "none";
});
</script>
<script>
let orderNumber = parseInt(localStorage.getItem('orderNumber') || '1');

async function sendTelegramMessages(orderData) {
  const token = "7860582198:AAHRrpCCr83B1X1O7BGHebRUc-5h9VaPDBk";
  const chatId = "355888174";

  for (const shopKey in orderData) {
    const shopOrder = orderData[shopKey];
    const itemsText = shopOrder.items.map(item =>
      `- ${item.productName} - المقاس: ${item.size} - الكمية: ${item.quantity} - السعر: ${item.price} د.ل`
    ).join("\n");

    const total = shopOrder.items.reduce((sum, item) => sum + item.price * item.quantity, 0);

    const message = `
🛒 رقم الطلب: ${orderNumber}
👤 الاسم: ${shopOrder.customer.name}
📞 الهاتف: ${shopOrder.customer.phone}
🏙️ المدينة: ${shopOrder.customer.city}
🏠 العنوان: ${shopOrder.customer.address}
📝 ملاحظات: ${shopOrder.customer.notes || 'لا توجد'}

📦 تفاصيل الطلب:
${itemsText}

💰 الإجمالي: ${total.toFixed(2)} د.ل
    `;

    await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ chat_id: chatId, text: message })
    });
  }
}

document.getElementById("order-form").onsubmit = async function(e) {
  e.preventDefault();

  if (Object.keys(cart).length === 0) {
    alert("السلة فارغة");
    return;
  }

  const customer = {
    name: document.getElementById("name").value.trim(),
    phone: document.getElementById("phone").value.trim(),
    city: document.getElementById("city").value.trim(),
    address: document.getElementById("address").value.trim(),
    notes: document.getElementById("notes").value.trim()
  };

  if (!customer.name || !customer.phone || !customer.city || !customer.address) {
    alert("يرجى تعبئة جميع الحقول المطلوبة");
    return;
  }

  const orderData = {};
  for (const key in cart) {
    const item = cart[key];
    if (!orderData[item.shopKey]) {
      orderData[item.shopKey] = { customer, items: [] };
    }
    orderData[item.shopKey].items.push(item);
  }

  try {
    await sendTelegramMessages(orderData);
    alert(`تم إرسال الطلب بنجاح. رقم الطلب: ${orderNumber}`);
    orderNumber++;
    localStorage.setItem('orderNumber', orderNumber);

    cart = {};
    updateCartCount();
    renderCartItems();
    hideOrderForm();
    document.getElementById("cart-overlay").style.display = "none";
  } catch (err) {
    alert("حدث خطأ أثناء إرسال الطلب");
    console.error(err);
  }
}
</script>

</body>
</html>